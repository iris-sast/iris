# CI Pipeline for IRIS Analysis

This repository contains a Continuous Integration (CI) pipeline designed to verify both Dockerized and native setups for the IRIS analysis tool. It also outlines the process for adding new projects and managing cached LLM inference outputs.

## 1\. CI Pipeline Overview

The CI pipeline is defined in the `.github/workflows/` directory. It consists of the following key jobs:

### 1.1. `verify-docker` Job

This job focuses on the Docker setup:

  * It builds the Docker image for IRIS.

  * It then runs the built Docker container to ensure basic functionality.

### 1.2. `get-projects` Job

This job is responsible for dynamically determining which projects to analyze:

  * It reads project configuration details from the `.github/workflows/to_build.json` file.

  * The data from this JSON file is then used to parametrize the subsequent `build-and-analyze` job, allowing for parallel execution across multiple projects.

### 1.3. `build-and-analyze` Job

This job handles the native setup and analysis for each project:

  * It runs in parallel for each project defined in `to_build.json`.

  * It sets up the required Java, Maven, and Gradle versions based on the project's configuration.

  * It downloads and extracts the CodeQL bundle.

  * It relocates cached LLM output for the specific project.

  * It builds the project using `scripts/setup.py`.

  * It generates the CodeQL database for the project.

  * It runs the IRIS analysis tool.

  * **Crucially, it includes a verification step that fails the job if the `results.json` file is not generated, ensuring analysis completion.**

## 2\. Project Configuration (`to_build.json`)

To add a new project to the CI analysis, you must update the `.github/workflows/to_build.json` file. This file is a JSON array, where each object in the array represents a project to be analyzed.

**Example `to_build.json` structure:**

```
[
  {
    "project_slug": "your_project_name",
    "java_version": "8",
    "maven_version": "3.5.0",
    "gradle_version": "",
    "cwe": "cwe-022wLLM"
  }
]

```

  * `project_slug`: A unique identifier for your project. This will be used for directory names and script parameters.

  * `java_version`: The Java Development Kit (JDK) version required for the project (e.g., "8", "11", "17").

  * `maven_version`: The Apache Maven version required (e.g., "3.5.0", "3.9.8"). Leave as an empty string `""` if not applicable.

  * `gradle_version`: The Gradle version required (e.g., "6.8.2", "7.6.4", "8.9"). Leave as an empty string `""` if not applicable.

  * `cwe`: The Common Weakness Enumeration (CWE) identifier relevant to the analysis (e.g., "cwe-022wLLM").

## 3\. LLM Inference and Cached Output

The CI pipeline is configured to **skip LLM inference steps** when running IRIS. This is achieved by providing pre-generated cached LLM output. IRIS automatically detects and utilizes this cached data, bypassing the need to call an LLM during the CI run.

All cached LLM output can be found in the `.github/cached_output/` directory.

### 3.1. Generating and Uploading Cached Output

To add a new project or update existing LLM inference results, you must:

1.  **Run IRIS locally with an LLM:**

      * It is recommended to use GPT-4 for this step.

      * Execute IRIS locally on the project you wish to add/update.

2.  **Upload project-specific folders:**

      * After the local IRIS run, navigate to the `output/` directory generated by IRIS.

      * Locate the project-specific folder (e.g., `your_project_name`).

      * Upload this project-specific folder from your local `output/` directory to `.github/cached_output/` in your repository, removing junk files.

      * **Critical files to retain within the project-specific folder:**

          * `common/llm_labelled_source_func_params.json`

          * `cwe-XXX/llm_labelled_sink_apis.json`

          * `cwe-XXX/llm_labelled_source_apis.json`

          * `cwe-XXX/llm_labelled_taint_prop_apis.json`

      * You can remove any other non-`.json` files from this project-specific folder before uploading to keep the repository lean.
